{% extends 'base.html' %}
{% block title %}Manage Students{% endblock %}
{% block content %}
{% include 'partials/admin_nav.html' with active_page='students' %}
<section class="two-col">
  <div class="panel">
    <h2>Add Student</h2>
    <form method="post" class="stack-form">
      {% csrf_token %}
      <div class="form-grid">
        <div><label>First Name</label>{{ form.first_name }}</div>
        <div><label>Last Name</label>{{ form.last_name }}</div>
        <div><label>Username</label>{{ form.username }}</div>
        <div><label>Password</label>{{ form.password }}</div>
        <div><label>Admission No</label>{{ form.admission_no }}</div>
        <div><label>Class</label>{{ form.class_name }}</div>
        <div><label>Section</label>{{ form.section }}</div>
        <div><label>Parent (optional)</label>{{ form.parent }}</div>
        <div><label>Date of Birth</label>{{ form.date_of_birth }}</div>
        <div class="full-row"><label>Address</label>{{ form.address }}</div>
      </div>
      {% if form.errors %}
      <div class="form-errors">{{ form.errors }}</div>
      {% endif %}
      <button class="btn btn-primary" type="submit">Create Student</button>
    </form>
  </div>

  <div class="panel">
    <h2>Students</h2>
    <table>
      <thead>
        <tr><th>Admission No</th><th>Name</th><th>Class</th><th>Parent</th></tr>
      </thead>
      <tbody>
        {% for student in students %}
        <tr>
          <td>{{ student.admission_no }}</td>
          <td>{{ student.user.get_full_name|default:student.user.username }}</td>
          <td>{{ student.class_name }} {{ student.section }}</td>
          <td>
            {% if student.parent %}
            {{ student.parent.user.get_full_name|default:student.parent.user.username }}
            {% else %}
            Not linked
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="4">No students available.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
