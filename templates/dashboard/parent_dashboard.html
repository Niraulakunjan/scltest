{% extends 'base.html' %}
{% block title %}Parent Portal{% endblock %}
{% block content %}
{% include 'partials/parent_nav.html' %}
<section class="panel">
  <h2>Child Selection</h2>
  <form method="get" class="inline-form">
    <select name="child" onchange="this.form.submit()">
      {% for child in children %}
      <option value="{{ child.id }}" {% if selected_child and child.id == selected_child.id %}selected{% endif %}>
        {{ child.admission_no }} - {{ child.user.get_full_name|default:child.user.username }}
      </option>
      {% endfor %}
    </select>
  </form>
</section>

{% if selected_child %}
<section class="grid-cards">
  <article class="metric-card">
    <p>Student</p>
    <h3>{{ selected_child.user.get_full_name|default:selected_child.user.username }}</h3>
  </article>
  <article class="metric-card">
    <p>Admission No</p>
    <h3>{{ selected_child.admission_no }}</h3>
  </article>
  <article class="metric-card">
    <p>Class</p>
    <h3>{{ selected_child.class_name }} {{ selected_child.section }}</h3>
  </article>
</section>

<section class="two-col">
  <div class="panel">
    <h2>Attendance History</h2>
    <table>
      <thead><tr><th>Date</th><th>Method</th><th>Time</th></tr></thead>
      <tbody>
        {% for item in attendance_records %}
        <tr><td>{{ item.date }}</td><td>{{ item.get_method_display }}</td><td>{{ item.marked_at|date:'H:i' }}</td></tr>
        {% empty %}
        <tr><td colspan="3">No attendance records.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="panel">
    <h2>Fee Records</h2>
    <table>
      <thead><tr><th>Term</th><th>Total</th><th>Paid</th><th>Due</th></tr></thead>
      <tbody>
        {% for fee in fee_records %}
        <tr><td>{{ fee.term }}</td><td>{{ fee.total_amount }}</td><td>{{ fee.paid_amount }}</td><td>{{ fee.due_amount }}</td></tr>
        {% empty %}
        <tr><td colspan="4">No fee records.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% else %}
<section class="panel">
  <p>No child linked to this parent account.</p>
</section>
{% endif %}

<section class="panel">
  <h2>Notices</h2>
  <table>
    <thead><tr><th>Title</th><th>Date</th></tr></thead>
    <tbody>
      {% for notice in notices %}
      <tr><td>{{ notice.title }}</td><td>{{ notice.created_at|date:'Y-m-d' }}</td></tr>
      {% empty %}
      <tr><td colspan="2">No notices.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
